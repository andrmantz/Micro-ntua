LXI B,0FFFH			;FOR DELB


BEGIN: 

	LDA 2000H		;INPUT
	RAR			; LSB = CY 
	JC BEGIN		;IF LSB=1, SWITCH UP, KEEP READING UNTIL SWITCH DOWN 
				
LSB0:			

	LDA 2000H		;READ INPUT 
	RAR		
	JNC LSB0	;READ INPUT UNTIL SWITCH IS UP


LSB1:	

	LDA 2000H	 
	RAR			
	JC LSB1	;WE HAD OFF-ON. READ UNTIL WE HAVE OFF AGAIN


LEDS_ON:		;OFF-ON-OFF 
	MVI D,00H		;(D)=0 --> LSB IS DOWN
	MVI E,12H		;COUNTER FOR TIME



LEDS_ON_OFF:	
	MVI A,00H		
	STA 3000H		;00000000, ALL LEDS OPEN
	CALL DELB
	MVI A,FFH		;11111111, ALL LEDS CLOSE
	STA 3000H
	CALL DELB				
	DCR E			
	MOV A,E		
	CPI 00H		
	JZ LEDS_OFF		;IF E =0 TIME IS OVER AND LEDS HAVE TO GO OFF
	MOV A,D      
	CPI 00H
	JZ CHECK		;IF D=0, CHECK IF THERE WAS ANY CHANGE ON THE SWITCH
	CPI 01H		
	JZ CHECKIFDOWN	;IF D=1, SWITCH IS ON,
				;CHECK IF IT WENT DOWN AGAIN TO REFRESH 
				
		
LEDS_OFF:			

	MVI A,FFH
	STA 3000H		;ALL LEDS OFF
	JMP BEGIN		


CHECK:			
	
	LDA 2000H 	
	RAR 			
	JNC LEDS_ON_OFF	
	INR D 			;IF LSB=1, SWITCH WENT ON AGAIN -> D=1
				
	JMP LEDS_ON_OFF


CHECKIFDOWN:
	
	LDA 2000H		
	RAR 			
	JC LEDS_ON_OFF	;IF LSB=1, NO CHANGES
	JMP LEDS_ON		;ELSE LSB=0 AND MUST REFRESH TIME AND D

END 
	